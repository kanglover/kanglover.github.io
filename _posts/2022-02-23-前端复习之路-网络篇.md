---
layout:     post
title:      网络篇
date:       2022-02-23
author:     shaokang
catalog: true
tags:
    - 复习
---

## RESTful
URL 定位资源，用 HTTP 动词（GET,POST,DELETE）描述操作。

## 浏览器地址栏输入网址整个过程
（1）解析 URL：分析传输协议和资源路径，判断协议或主机名是否合法，不合法将内容传递给搜索引擎。没问题的话检查是否出现非法字符，并对其转义。  
（2）缓存判断：强缓存和协商缓存。  
（3）DNS 解析：先查本地是否有域名的 ip 地址缓存（浏览器、hosts 文件）。若没有会想本地 DNS 服务器发起请求，检查是否存在缓存。若还是没有，解析想根域名服务器发起请求。依次查找顶级域名服务器、权威域名服务器，直到拿到 IP 地址返回给用户。（用户向本地 DNS 请求输入递归请求，本地 DNS 向各级域名请求属于迭代请求）  
（4）获取 MAC 地址：当浏览器得到 IP 地址后，数据传输还需要知道目的主机 MAC 地址，因为应用层下发数据给传输层，TCP 协议会指定源端口号和目的端口号，然后下发给网络层。网络层会将本机地址作为源地址，获取的 IP 地址作为目的地址。然后将下发给数据链路层，数据链路层的发送需要加入通信双方的 MAC 地址，本机的 MAC 地址作为源 MAC 地址，目的 MAC 地址需要分情况处理。通过将 IP 地址与本机的子网掩码相与，可以判断是否与请求主机在同一个子网里，如果在同一个子网里，可以使用 APR 协议获取到目的主机的 MAC 地址，如果不在一个子网里，那么请求应该转发给网关，由它代为转发，此时同样可以通过 ARP 协议来获取网关的 MAC 地址，此时目的主机的 MAC 地址应该为网关的地址.  
（5）TCP 三次握手：首先客户端向服务器发送一个 SYN 连接请求报文段和一个随机序号，服务端接收到请求后向服务器端发送一个 SYN ACK报文段，确认连接请求，并且也向客户端发送一个随机序号。客户端接收服务器的确认应答后，进入连接建立的状态，同时向服务器也发送一个ACK 确认报文段，服务器端接收到确认后，也进入连接建立状态，此时双方的连接就建立起来了。  
（6）HTTPS 握手：如果使用的是 HTTPS 协议，在通信前还存在 TLS 的一个四次握手的过程。首先由客户端向服务器端发送使用的协议的版本号、一个随机数和可以使用的加密方法。服务器端收到后，确认加密的方法，也向客户端发送一个随机数和自己的数字证书。客户端收到后，首先检查数字证书是否有效，如果有效，则再生成一个随机数，并使用证书中的公钥对随机数加密，然后发送给服务器端，并且还会提供一个前面所有内容的 hash 值供服务器端检验。服务器端接收后，使用自己的私钥对数据解密，同时向客户端发送一个前面所有内容的 hash 值供客户端检验。这个时候双方都有了三个随机数，按照之前所约定的加密方法，使用这三个随机数生成一把秘钥，以后双方通信前，就使用这个秘钥对数据进行加密后再传输。  


## HTTPS 加密原理
see: https://zhuanlan.zhihu.com/p/43789231

### 准备工作（数字证书认证机构的业务流程）
1. 服务器的运营人员向第三方机构 CA 提交`公钥`、组织信息、个人信息（域名）等信息并申请认证。
2. CA 通过线上、线下等多种手段验证申请者提供信息的真实性。
3. CA 审核通过后，向申请者签发证书。证书包含了`申请者的公钥`、申请者的组织信息和个人信息、CA 的信息、有效时间、证书序列号等信息的明文，同时包含一个签名（使用散列函数计算出公开的明文信息的`信息摘要`，然后通过 CA 的`私钥`对其加密得到签名）。

### 请求过程
1. 客户端发起请求。
2. 服务端将之前的签发的证书返回给客户端。
3. 客户端验证该证书：证书是否再有效期内，证书的用途是否匹配客户端请求站点，是否被吊销、上一级证书是否有效...。
4. 客户端使用 CA 提前植入到浏览器的`公钥`，解密获得信息摘要。然后用 HASH 函数对原文再重新生成一个摘要信息，与解密得到的信息进行对比，如果相同则该信息没有被修改过。
5. 客户端使用伪随机数生成器生成`对称密钥`，然后用服务端的`公钥`对其加密发送给服务端。
6. 服务端通过`私钥`解密获得`对称密钥`，使用该密钥对内容进行加密。
7. 客户端使用密钥对内容进行解密。

## TLS 握手各版本差异
参考：https://juejin.cn/post/6895624327896432654



## 首屏性能优化
1. 资源加载优化
   * 减少资源大小：代码压缩、Gzip、图片压缩、代码拆分
   * 减少 HTTP 请求数：Http 强缓存、Service Worker、本地存储、合并请求（nginx-http-concat、雪碧图）
   * 提高 HTTP 请求响应速度：CDN、http 弱缓存、DNS Prefetch、http2
   * 优化资源加载时机：按需加载、懒加载、预加载（preload）
   * 优化资源、内容加载方式：客户端 H5 考虑离线包、内容直出
2. 页面渲染优化
   * 优化 html：js 外链放在底部、css 外链放在顶部、减少 DOM 数量
   * 优化 js、css：webworker、长任务分片执行、减少重排重绘、降低 css 选择器复杂性
   * 优化动画效果：使用 requestAnimationFrame、使用 transform 和 opacity 实现动画、使用 will-change 或者 translateZ 来提升某些元素到新的合成层。


